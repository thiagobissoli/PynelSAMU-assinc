{% extends "base.html" %}

{% block title %}Criar Alerta Manual{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-plus-circle"></i> Criar Alerta Manual</h1>
    <a href="{{ next_url or url_for('alertas.dashboard') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Voltar
    </a>
</div>

<form method="POST">
    {% if next_url %}<input type="hidden" name="next" value="{{ next_url }}">{% endif %}
    <div class="card">
        <div class="card-body">
            <div class="mb-3">
                <label for="titulo" class="form-label">Título <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="titulo" name="titulo" required>
            </div>
            <div class="mb-3">
                <label for="mensagem" class="form-label">Mensagem <span class="text-danger">*</span></label>
                <textarea class="form-control" id="mensagem" name="mensagem" rows="4" required></textarea>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Ícone</label>
                    <div class="dropdown">
                        <button type="button" class="btn btn-outline-secondary dropdown-toggle d-flex align-items-center gap-2" data-bs-toggle="dropdown" aria-expanded="false" id="iconeBtn">
                            <i class="bi bi-megaphone" id="iconePreview" style="font-size: 1.3rem;"></i>
                        </button>
                        <input type="hidden" name="icone" id="icone" value="megaphone">
                        <div class="dropdown-menu p-2 icone-dropdown-menu">
                            <div class="icone-grid">
                                {% for valor, rotulo in icones %}
                                <button type="button" class="btn btn-sm btn-outline-secondary p-2 icone-opt" data-icon="{{ valor }}" title="{{ rotulo }}">
                                    <i class="bi bi-{{ valor }}"></i>
                                </button>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Cor</label>
                    <div class="dropdown">
                        <button type="button" class="btn btn-outline-secondary dropdown-toggle d-flex align-items-center gap-2" data-bs-toggle="dropdown" aria-expanded="false">
                            <span id="corPreview" class="cor-swatch" style="background: #6c757d;"></span>
                        </button>
                        <input type="hidden" name="cor" id="cor" value="#6c757d">
                        <div class="dropdown-menu p-2 cor-dropdown-menu">
                            <div class="cor-grid">
                                {% for hex_val, nome in cores %}
                                <button type="button" class="btn btn-sm p-2 cor-opt" data-cor="{{ hex_val }}" title="{{ nome }}" style="background: {{ hex_val }}; border: 2px solid rgba(0,0,0,0.2); min-width: 36px; min-height: 36px;"></button>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Criar Alerta
            </button>
            <a href="{{ next_url or url_for('alertas.dashboard') }}" class="btn btn-secondary">Cancelar</a>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_head %}
<style>
.icone-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; max-height: 220px; overflow-y: auto; }
.icone-opt { min-width: 42px; font-size: 1.2rem; }
.icone-opt:hover { background: var(--bs-primary); color: white !important; border-color: var(--bs-primary); }
.icone-opt i { display: block; }
.icone-dropdown-menu { min-width: 260px; }
.cor-swatch { width: 24px; height: 24px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.2); display: inline-block; }
.cor-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; }
.cor-opt { border-radius: 6px !important; }
.cor-opt:hover { transform: scale(1.1); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
.cor-dropdown-menu { min-width: 220px; }
</style>
{% endblock %}

{% block scripts %}
<script>
document.querySelectorAll('.icone-opt').forEach(function(btn) {
    btn.addEventListener('click', function(e) {
        e.preventDefault();
        var icon = this.dataset.icon;
        var dropdown = this.closest('.dropdown');
        dropdown.querySelector('#icone').value = icon;
        dropdown.querySelector('#iconePreview').className = 'bi bi-' + icon;
        bootstrap.Dropdown.getInstance(dropdown.querySelector('[data-bs-toggle="dropdown"]'))?.hide();
    });
});
document.querySelectorAll('.cor-opt').forEach(function(btn) {
    btn.addEventListener('click', function(e) {
        e.preventDefault();
        var cor = this.dataset.cor;
        var dropdown = this.closest('.dropdown');
        dropdown.querySelector('#cor').value = cor;
        dropdown.querySelector('#corPreview').style.background = cor;
        bootstrap.Dropdown.getInstance(dropdown.querySelector('[data-bs-toggle="dropdown"]'))?.hide();
    });
});
</script>
{% endblock %}
